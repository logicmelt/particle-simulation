
## Relevant parameters

In most cases the following parameters are the ones that should be changed for a simulation (See [this](docs/input_parameters.md) for all the available parameters):

- save_dir (str, **Required**): This is the root directory where all the files and subfolders will be created
- random_seed (int, Optional): Random seed for reproducibility. If not provided, it will be set to the current time.
- **num_processes** (int, Optional): Number of processes to use for simulation. Each process will generate particles_per_run particles.
- **particles_per_run** (int, Optional): Number of protons to be used for the simulation.
- constructor:
    - density_profile
        - density_file (str, **Required**): Path to the json file with the density profiles. This should follow the format described [here](docs/density_profiles.md). We only have one file for Vigo/Santiago [here](additional_files/data_files/density_temp_height.json).
    - magnetic_field: Set a latitude, longitude and time
        - mag_source (str, Optional): Source of the magnetic field: "file" or "estimated" (from latitude, longitude and date). Defaults to file.
        - latitude (float, Optional): Latitude of the detector in decimal degrees (World Geodetic System 1984). Positive north equator and values between -90º to 90º. Defaults t 42.224º.
        - longitude (float, Optional): Longitude of the detector in decimal degrees (World Geodetic System 1984). Positive east of the prime meridian and values between -180º to 180º. Defaults to -8.716º.
        - mag_time (str, Optional): Date to get the magnetic field values. Format YYYY-MM-DD. Defaults to 2021-01-01.

particles_per_run has to be chosen depending on the expected muon rate. We can obtain the muon rate from https://publications.gc.ca/collections/collection_2016/rddc-drdc/D68-4-128-2013-eng.pdf page 95 "given the fairly low cosmic ray muon
rate of 1 cm-2 min-1.". This implies that the muon rate is 1 cm-2 min-1 or in square meters and seconds: ~167 m-2 s-1. Therefore, given that the efficiency of our simulation is approximately ~0.7% this means that we need to shoot **24000** particles per run to simulate one second of data.

This simulation can be speed up using multiprocessing by using num_processes. Each process will shoot particles_per_run particles. Hence, if this value is set to 10 and particles_per_run to 2400 then 24000 particles will be simulated.

The effects of a solar disturbance can be generated by reducing the total particles_per_run by a factor 25-30% for a few days(Forbush Decrease, see https://publications.gc.ca/collections/collection_2016/rddc-drdc/D68-4-128-2013-eng.pdf page 28). This means values between 16800 and 18000.

## How to run the ICOS sim

To run the ICOS simulation you can use the docker or by running the CLI command **icos_sim**. This will run the simulation sim_cycles times and save the results in save_dir defined in the config file. By default the time_resolution is set to 1s. If this value is changed then the particles_per_run and num_processes should be changed accordingly to maintain the desired muon output.

```bash
 icos_sim [-h] [--config_file CONFIG_FILE] [--sim_cycles SIM_CYCLES] [--restart] [--time_resolution TIME_RESOLUTION] [--random_seed int] [--num_processes int]
                [--logger_level str] [--particles_per_run int] [--generator JSON] [--generator.gen_type str] [--generator.n_events int] [--generator.energy float]
                [--generator.particle str] [--generator.position tuple[float,float,float]] [--generator.direction tuple[float,float,float]] [--constructor JSON]
                [--constructor.input_geom str] [--constructor.gdml_file Path] [--constructor.magnetic_field JSON] [--constructor.magnetic_field.enabled bool]
                [--constructor.magnetic_field.mag_source str] [--constructor.magnetic_field.mag_file Path] [--constructor.magnetic_field.latitude float]
                [--constructor.magnetic_field.longitude float] [--constructor.magnetic_field.mag_time datetime] [--constructor.sensitive_detectors JSON]
                [--constructor.sensitive_detectors.enabled bool] [--constructor.sensitive_detectors.altitude tuple[float,...]]
                [--constructor.sensitive_detectors.particles tuple[str,...]] [--constructor.export_gdml bool] [--constructor.geometry str]
                [--constructor.earth_radius float] [--constructor.atmos_size float] [--constructor.atmos_height float] [--constructor.atmos_comp tuple[{str,float},...]]
                [--constructor.atmos_n_points int] [--constructor.density_profile JSON] [--constructor.density_profile.density_file Path]
                [--constructor.density_profile.day_idx int] [--macro_files {tuple[Path,...],Path}] [--save_dir Path]

Particle simulation of a cosmic shower using Geant4 and Python.
```

The formatted output is saved in save_dir/output_jsons



